{"version":3,"file":"popin.js","sources":["../../src/javascript/src/common/drupal/drupal.js","../../src/javascript/src/popin/src/PopinDefault.js","../../src/javascript/src/popin/popin.js"],"sourcesContent":["export let T = {\n    /**\n     * Renvoie vrai si le context est root (document)\n     * @param context\n     */\n    contextIsRoot: function( context){\n        return 'HTML' === context.children[0].tagName;\n    },\n    /**\n     * Retourne vrai si la variable est définie.\n     * @param variable\n     * @returns {boolean}\n     */\n    isDefined: function (variable) {\n        return 'undefined' !== typeof variable;\n    },\n    /**\n     * Retourne la taille de la fenêtre dans un objet avec .width et .height\n     * @returns object\n     */\n    viewport: function () {\n        var e = window, a = 'inner';\n        if (!('innerWidth' in window )) {\n            a = 'client';\n            e = document.documentElement || document.body;\n        }\n        return { width : e[ a+'Width' ] , height : e[ a+'Height' ]};\n    }\n};\nexport let DrupalHelpers = {\n    getBasePath() {\n        return drupalSettings.path.baseUrl + drupalSettings.path.pathPrefix;\n    }\n};","import { T } from \"../../common/drupal/drupal\";\n\nclass PopinDefault {\n\n    constructor() {\n        this.popinSelector = \".Popin\";\n        this.popinWrapperSelector = \".Popin-wrapper\";\n        this.popinTriggerSelector = \".Popin-trigger\";\n        this.closePopinButtonTitle = Drupal.t(\"Fermer la popin\");\n        this.specificClasses = [];\n        this.closePopinElement;\n        this.handleEscape = this.handleEscape.bind(this);\n    }\n    /**\n     * Initialize event listeners\n     */\n    init() {\n        const that = this;\n        this.$body = document.body;\n        this.$popins = document.querySelectorAll(this.popinSelector);\n        this.$popinWrappers = [];\n        this.$popins.forEach((popin) => { \n            this.$popinWrappers.push(popin?.querySelector(this.popinWrapperSelector));\n        });\n        this.$triggers = document.querySelectorAll(this.popinTriggerSelector);\n\n        this.$triggers.forEach((trigger) => {\n            trigger.addEventListener(\"click\", (ev) => {\n                this.triggerClick(ev);\n            });\n        });\n\n        let closePopinElement = this.createCloseButton();\n\n        this.$popinWrappers?.forEach((popinWrapper) => {\n            let clonedCloseButton = closePopinElement.cloneNode(true);\n            popinWrapper.appendChild(clonedCloseButton);\n            this.closePopinElement = clonedCloseButton;\n            clonedCloseButton.addEventListener(\"click\", (ev) => {\n                this.closePopins();\n            })\n        })\n\n        this.$popins.forEach((popin) => {\n            popin.addEventListener(\"click\", function (ev) {\n                if(ev.target === this) {\n                    that.closePopins();\n                }\n            });\n        });\n\n\n    }\n\n    addTabIndex(popin) {\n        var firstTabIndex = document.createElement(\"div\");\n        var lastTabIndex = document.createElement(\"div\");\n        firstTabIndex.setAttribute(\"tabindex\", 0);\n        lastTabIndex.setAttribute(\"tabindex\", 0);\n        popin.insertBefore(firstTabIndex, popin.firstChild);\n        popin.appendChild(lastTabIndex);\n    }\n\n    removeTabIndex(popin) {\n        var tabsIndex = popin.querySelectorAll(\"div[tabindex='0']\");\n        for (var i = 0; i < tabsIndex.length; i++) {\n            tabsIndex[i].remove();\n        }\n    }\n\n    /**\n     * Open modal when click on trigger\n     */\n    triggerClick(ev) {\n\n        this.closePopins();\n\n\n        let target = ev.currentTarget.dataset.popinTarget;\n        let popin = document.querySelector(target);\n        this.addTabIndex(popin);\n        popin.classList.add(\"open\");\n\n        document.addEventListener(\"keypress\", this.handleEscape);\n\n        // freeze body to prevent scroll\n        this.$body.classList.add(\"no-scroll\", ...this.specificClasses);\n    }\n\n    /**\n     * Close all popins\n     */\n    closePopins() {\n        document.removeEventListener(\"keypress\", this.handleEscape);\n\n        this.$popins.forEach((popin) => {\n            popin.classList.remove(\"open\");\n            this.removeTabIndex(popin);\n        })\n\n\n        //REMOVE FROZEN STATE OF BODY\n        this.$body.classList.remove(\"no-scroll\", ...this.specificClasses);\n    }\n\n    createCloseButton() {\n        let closeButton = document.createElement(\"button\");\n        closeButton.classList.add(\"Popin-close\", \"icon-cross\", \"fa-thin\", \"fa-times\");\n        closeButton.setAttribute(\"role\", \"button\");\n        closeButton.setAttribute(\"title\", this.closePopinButtonTitle);\n        return closeButton;\n    }\n\n    handleEscape(event) {\n        if(event.keyCode === 27) {\n            this.closePopins();\n        }\n    }\n\n    /**\n     * Attach.\n     * @param context\n     */\n    attach(context) {\n        if (T.contextIsRoot(context)) {\n            this.init(context);\n        }\n    }\n}\n\nexport default PopinDefault;\nexport let popinDefault = new PopinDefault();\n","import {popinDefault} from \"./src/PopinDefault\";\n\n(function (Drupal) { // closure\n    'use strict';\n\n    // Popin\n    Drupal.behaviors.popinDefault = popinDefault;\n    \n}(Drupal));"],"names":["T","contextIsRoot","context","children","tagName","isDefined","variable","viewport","e","window","a","document","documentElement","body","width","height","PopinDefault","popinSelector","popinWrapperSelector","popinTriggerSelector","closePopinButtonTitle","Drupal","t","specificClasses","closePopinElement","handleEscape","bind","that","$body","$popins","querySelectorAll","$popinWrappers","forEach","popin","push","querySelector","$triggers","trigger","addEventListener","ev","triggerClick","createCloseButton","popinWrapper","clonedCloseButton","cloneNode","appendChild","closePopins","target","firstTabIndex","createElement","lastTabIndex","setAttribute","insertBefore","firstChild","tabsIndex","i","length","remove","currentTarget","dataset","popinTarget","addTabIndex","classList","add","removeEventListener","removeTabIndex","closeButton","event","keyCode","init","popinDefault"],"mappings":"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"}